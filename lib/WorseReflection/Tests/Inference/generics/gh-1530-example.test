<?php

namespace Test;

interface Foo {
    public function bar(): void;
}

interface Foos {
    /**
     * @return Collection<int, Foo>
     */
    public function all(): Collection;
}

/**
 * @template TKey of array-key
 * @template T
 * @template-extends \IteratorAggregate<TKey, T>
 * @template-extends \ArrayAccess<TKey|null, T>
 */
interface Collection extends \IteratorAggregate, \ArrayAccess
{
    /**
     * @return T
     */
    public function first();

    /**
     * @return Collection<TKey, T>
     */
    public function filter(\Closure $p);
}

function foobar(Foos $foos) {
    wrAssertType('Test\Foo', $foos->all()->first());
}
